/*=========================================
MSBI.DEV.COURSE.S20E09.SCRIPT
=========================================*/


USE TSQL2012;
BEGIN TRAN;

------------------------------------------------------------------------

-----------------------------------------------------------------------

UPDATE Production.Suppliers
SET Fax = N'555-1212'
WHERE supplierid = 1


----------------------------------------------------------------------




----------------------------------------------------------------------


UPDATE HR.Employees
SET phone = N'555-9999'
WHERE empid = 1




IF @@TRANCOUNT > 0 ROLLBACK



-- DEADLOCK

USE TSQL2012;
BEGIN TRAN;

----------------------------------------------------------------------




----------------------------------------------------------------------
UPDATE HR.Employees
SET phone = N'555-9999'
WHERE empid = 1

-----------------------------------------------------------------------





-----------------------------------------------------------------------



/*=========================================
READ COMMITTED
=========================================*/

USE TSQL2012;
BEGIN TRAN;

-------------------------------------------
UPDATE HR.Employees
SET postalcode = N'10006'
WHERE empid = 1;
----------------------------------------------





-----------------------------------------------




COMMIT TRAN;




-- Cleanup:
UPDATE HR.Employees
SET postalcode = N'10003'
WHERE empid = 1;


/*=========================================
READ UNCOMMITTED
Session 1
=========================================*/

USE TSQL2012;
BEGIN TRAN;
--1------------------------------------------------------------
UPDATE HR.Employees
SET postalcode = N'1004'
WHERE empid = 1;
--2------------------------------------------------------------
--3------------------------------------------------------------
ROLLBACK TRAN;
--4------------------------------------------------------------
--5------------------------------------------------------------
-- Cleanup:
UPDATE HR.Employees
SET postalcode = N'10003'
WHERE empid = 1;
--6------------------------------------------------------------


/*=========================================
REPEATABLE READ
=========================================*/

BEGIN TRAN;
--1------------------------------------------------------------
--2------------------------------------------------------------
UPDATE HR.Employees
SET postalcode = N'1004'
WHERE empid = 1;
--3------------------------------------------------------------
--4------------------------------------------------------------
ROLLBACK TRAN;


/*=========================================
READ COMMITTED SNAPSHOT Session 2
=========================================*/


--1------------------------------------------------------------
USE TSQL2012;
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
--2------------------------------------------------------------
--3------------------------------------------------------------
SELECT empid, lastname, firstname, postalcode
FROM HR.Employees;
--4------------------------------------------------------------
--5------------------------------------------------------------
--6------------------------------------------------------------



/*=========================================
READ UNCOMMITTED
=========================================*/


--1------------------------------------------------------------
--2------------------------------------------------------------
--3------------------------------------------------------------
--4------------------------------------------------------------
--5------------------------------------------------------------
--6------------------------------------------------------------