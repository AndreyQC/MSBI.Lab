/*=========================================
MSBI.DEV.COURSE.S18E09.SCRIPT
=========================================*/


/*=========================================
blocking
=========================================*/

USE TSQL2012;
BEGIN TRAN;

---------------------------------------------------------------

UPDATE HR.Employees
SET Region = N'10004'
WHERE empid = 1


---------------------------------------------------------------





---------------------------------------------------------------


UPDATE Production.Suppliers
SET Fax = N'555-1212'
WHERE supplierid = 1


---------------------------------------------------------------


IF @@TRANCOUNT > 0 ROLLBACK



/*=========================================
READ COMMITTED
=========================================*/

USE TSQL2012;
SET TRANSACTION ISOLATION
LEVEL READ COMMITTED;
-----------------------------------------------------




------------------------------------------------------
SELECT lastname, firstname
FROM HR.Employees;

-------------------------------------------------------





/*=========================================
READ UNCOMMITTED
Session 2
=========================================*/

USE TSQL2012;
SET TRANSACTION ISOLATION LEVEL READ
UNCOMMITTED;
--1------------------------------------------------------------

--2------------------------------------------------------------
SELECT lastname, firstname, region
FROM HR.Employees
--3------------------------------------------------------------
--4------------------------------------------------------------
SELECT lastname, firstname, region
FROM HR.Employees;
--5------------------------------------------------------------
--6------------------------------------------------------------

SELECT lastname, firstname
FROM HR.Employees WITH (READUNCOMMITTED);

/*=========================================
READ COMMITTED SNAPSHOT Session 1
=========================================*/

USE TSQL2012;
ALTER DATABASE TSQL2012 SET
READ_COMMITTED_SNAPSHOT ON;
--1------------------------------------------------------------
BEGIN TRAN;
--2------------------------------------------------------------
UPDATE HR.Employees
SET postalcode = N'10007'
WHERE empid = 1;
--3------------------------------------------------------------
--4------------------------------------------------------------
ROLLBACK TRAN;
--5------------------------------------------------------------
--6------------------------------------------------------------
-- Cleanup:
UPDATE HR.Employees
SET postalcode = N'10003'
WHERE empid = 1;


/*=========================================
READ UNCOMMITTED
=========================================*/


--1------------------------------------------------------------
--2------------------------------------------------------------
--3------------------------------------------------------------
--4------------------------------------------------------------
--5------------------------------------------------------------
--6------------------------------------------------------------